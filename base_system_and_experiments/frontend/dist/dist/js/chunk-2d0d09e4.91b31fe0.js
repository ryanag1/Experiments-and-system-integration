(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d09e4"],{"696a":function(e,t,c){"use strict";c.r(t);var o=function(){var e=this,t=e.$createElement,c=e._self._c||t;return c("v-dialog",{attrs:{"max-width":"1400",fullscreen:"",persistent:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[c("v-card",[c("v-card-title",{staticClass:"headline"},[c("v-icon",{staticClass:"mr-2",attrs:{color:"indigo"}},[e._v("mdi-database-check")]),e._v(" Call to ... "),c("v-spacer")],1),c("v-card-text",[c("v-container",[c("v-row",[c("v-col",{staticClass:"text-right"},[c("v-btn",{attrs:{icon:""}},[c("v-icon",[e._v("mdi-monitor-off")])],1)],1)],1),c("v-row",[c("v-col",{staticClass:"text-center"},[c("div",{staticStyle:{display:"block"},attrs:{id:"media"}},[c("audio",{attrs:{id:"audio",autoplay:"true"}}),c("video",{attrs:{id:"video",autoplay:"true",playsinline:"true"}})])])],1)],1)],1),c("v-card-actions",[c("v-spacer"),c("v-btn",{staticClass:"mr-6",attrs:{fab:"",dark:"",color:"primary"},on:{click:e.startCalling}},[c("v-icon",[e._v("mdi-phone-in-talk")])],1),c("v-btn",{staticClass:"ml-6",attrs:{fab:"",dark:"",color:"pink"},on:{click:e.closeDialog}},[c("v-icon",[e._v("mdi-phone-off")])],1),c("v-spacer")],1)],1)],1)},n=[],s=(c("a277"),c("241c"),{data:function(){return{show:!1,dc:null,iceGatheringLog:"",iceConnectionLog:"",signalingLog:"",recievedMsg:null,toUserId:null,time_start:null,dcInterval:null}},props:["duct","opponentId","fetchData","sender","reciever","userId","pc"],created:function(){var e=this;this.duct.invokeOrWaitForOpen((function(){e.duct.eventListeners.resource.on("addDataForSpecificUser",{success:function(e){console.log("storedData"),console.log(e)},error:function(e){console.log(e)}})}))},components:{},computed:{},methods:{current_stamp:function(){return null===this.time_start?(this.time_start=(new Date).getTime(),0):(new Date).getTime()-this.time_start},closeDialog:function(){this.pc.close();var e={sender:!1,reciever:!1};this.$emit("sr-change",e),this.duct.controllers.resource.addDataForSpecificUser(localStorage.getItem("userId"),localStorage.getItem("userId"),"{token:'terminate'}"),this.duct.controllers.resource.fetchDataFromSpecificUser(localStorage.getItem("userId"),localStorage.getItem("clientToken")),this.show=!1},startCalling:function(){var e=this;if(this.time_start=null,this.dc=this.pc.createDataChannel("chat",{ordered:!0}),this.dc.onclose=function(){clearInterval(this.dcInterval),console.log("- close")},this.dc.onopen=function(){console.log("- open"),this.dcInterval=setInterval((function(){var t="ping "+e.current_stamp();console.log("> "+t),e.dc.send(t)}),1e3)},this.dc.onmessage=function(t){if(console.log("< "+t.data),"pong"===t.data.substring(0,4)){var c=e.current_stamp()-parseInt(t.data.substring(5),10);console.log(" RTT "+c+" ms")}},this.pc.addEventListener("track",(function(e){"video"==e.track.kind?document.getElementById("video").srcObject=e.streams[0]:document.getElementById("audio").srcObject=e.streams[0]})),this.reciever)console.log("answer"),this.pc.createAnswer().then((function(t){return console.log(t),e.pc.setLocalDescription(t)})).then((function(){var t=e.pc.localDescription;e.duct.controllers.resource.addDataForSpecificUser(e.toUserId,e.userId,JSON.stringify(t))}));else{if(!this.reciever){var t={sender:!0,reciever:!1};this.$emit("sr-change",t)}console.log(this.opponentId),this.pc.createOffer().then((function(t){return console.log("offer"),console.log(t),e.pc.setLocalDescription(t)})).then((function(){return new Promise((function(t){if("complete"===e.pc.iceGatheringState)t();else{function c(){"complete"===e.pc.iceGatheringState&&(e.pc.removeEventListener("icegatheringstatechange",c),t())}e.pc.addEventListener("icegatheringstatechange",c)}}))})).then((function(){var t=e.pc.localDescription;e.duct.controllers.resource.addDataForSpecificUser(e.opponentId,e.userId,JSON.stringify(t))}))}}},watch:{fetchData:function(){console.log(this.fetchData),"{token:'terminate'}"==this.fetchData["Message"]?console.log("terminate2"):(this.recievedMsg=this.fetchData["Message"],this.toUserId=this.fetchData["FromUserId"],this.sender,console.log(this.recievedMsg),console.log(JSON.parse(this.recievedMsg)),this.pc.setRemoteDescription(JSON.parse(this.recievedMsg)))}}}),a=s,r=c("a6c2"),i=c("411c"),l=c.n(i),d=c("9c46d"),u=c("d58c"),h=c("e47e"),p=c("1fb1"),g=c("f56c"),v=c("c56b"),f=c("b503"),m=c("e614"),I=c("61ac"),D=Object(r["a"])(a,o,n,!1,null,null,null);t["default"]=D.exports;l()(D,{VBtn:d["a"],VCard:u["a"],VCardActions:h["a"],VCardText:h["c"],VCardTitle:h["d"],VCol:p["a"],VContainer:g["a"],VDialog:v["a"],VIcon:f["a"],VRow:m["a"],VSpacer:I["a"]})}}]);
//# sourceMappingURL=chunk-2d0d09e4.91b31fe0.js.map