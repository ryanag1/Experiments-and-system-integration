(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d0455"],{"66ed":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{"max-width":"1400",fullscreen:"",persistent:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[n("v-icon",{staticClass:"mr-2",attrs:{color:"indigo"}},[e._v("mdi-database-check")]),e._v(" Call to ... "),n("v-spacer")],1),n("v-card-text",[n("v-container",[n("v-row",[n("v-col",{staticClass:"text-right"},[n("v-btn",{attrs:{icon:""}},[n("v-icon",[e._v("mdi-monitor-off")])],1)],1)],1),n("v-row",[n("v-col",{staticClass:"text-center"},[n("div",{staticStyle:{display:"block"},attrs:{id:"media"}},[n("audio",{attrs:{id:"audio",autoplay:"true"}}),n("video",{attrs:{id:"video",autoplay:"true",playsinline:"true"}})])])],1),n("v-row",[n("v-col",[n("v-textarea",{attrs:{clearable:"",height:"100%"},model:{value:e.rttpp,callback:function(t){e.rttpp=t},expression:"rttpp"}})],1)],1)],1)],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{staticClass:"mr-6",attrs:{fab:"",dark:"",color:"primary"},on:{click:e.startCalling}},[n("v-icon",[e._v("mdi-phone-in-talk")])],1),n("v-btn",{staticClass:"ml-6",attrs:{fab:"",dark:"",color:"pink"},on:{click:e.closeDialog}},[n("v-icon",[e._v("mdi-phone-off")])],1),n("v-spacer")],1)],1)],1)},c=[],s=(n("241c"),n("dddc"),n("a277"),{data:function(){return{show:!1,dc:null,iceGatheringLog:"",iceConnectionLog:"",signalingLog:"",recievedMsg:null,toUserId:null,time_start:null,dcInterval:null,pc:null,rttpp:null,rowque:"",que:[],csvf:!1,csvfcount:0,scInterval:null,itcount:0}},props:["duct","opponentId","fetchData","sender","reciever","userId"],created:function(){var e=this;this.duct.invokeOrWaitForOpen((function(){e.duct.eventListeners.resource.on("addDataForSpecificUser",{success:function(e){console.log("storedData"),console.log(e)},error:function(e){console.log(e)}}),e.duct.eventListeners.resource.on("csvWriter",{success:function(e){console.log("csvWriter"),console.log(e)},error:function(e){console.log(e)}}),e.duct.eventListeners.resource.on("pingPong",{success:function(t){if(console.log("< "+t["pong"]),e.rttpp+="< "+t["pong"]+"\n","pong"===t["pong"].substring(0,4)){var n=self.current_stamp()-parseInt(t["pong"].substring(5),10);console.log(" RTT "+n+" ms"),e.rttpp+=" RTT "+n+" ms\n",e.rowque+=t["pong"].substring(5)+","+n+";",e.csvfcount++,e.csvfcount>10&&(e.csvf=!self.csvf,e.csvfcount=0,e.itcount++)}e.itcount>113&&clearInterval(e.scInterval)},error:function(e){console.log(e)}})}))},components:{},computed:{},methods:{current_stamp:function(){return null===this.time_start?(this.time_start=(new Date).getTime(),0):(new Date).getTime()-this.time_start},closeDialog:function(){this.pc.close();var e={sender:!1,reciever:!1};this.$emit("sr-change",e),this.duct.controllers.resource.addDataForSpecificUser(localStorage.getItem("userId"),localStorage.getItem("userId"),"{token:'terminate'}"),this.duct.controllers.resource.fetchDataFromSpecificUser(localStorage.getItem("userId"),localStorage.getItem("clientToken")),this.show=!1},startCalling:function(){var e=this;this.rttpp="HELLO\n";var t={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};if(this.pc=new RTCPeerConnection(t),this.pc.addEventListener("icegatheringstatechange",(function(){e.iceGatheringLog+=" -> "+e.pc.iceGatheringState,console.log(e.iceGatheringLog)}),!1),this.iceGatheringLog=this.pc.iceGatheringState,this.pc.addEventListener("iceconnectionstatechange",(function(){e.iceConnectionLog+=" -> "+e.pc.iceConnectionState,console.log(e.iceConnectionLog)}),!1),this.iceConnectionLog=this.pc.iceConnectionState,this.pc.addEventListener("signalingstatechange",(function(){e.signalingLog+=" -> "+e.pc.signalingState,console.log(e.signalingLog)}),!1),this.signalingLog=this.pc.signalingState,this.pc.addEventListener("track",(function(e){"video"==e.track.kind?document.getElementById("video").srcObject=e.streams[0]:document.getElementById("audio").srcObject=e.streams[0]})),navigator.mediaDevices.getUserMedia({video:{width:{min:320,max:1280},height:{min:240,max:720},frameRate:{min:1,max:10}},audio:!0}).then((function(t){t.getTracks().forEach((function(n){e.pc.addTrack(n,t)}))}),(function(e){alert("Could not acquire media: "+e)})),this.reciever?this.pc.ondatachannel=function(e){var t=e.channel;t.onopen=function(e){console.log("Hello Back! "+e.data)},t.onmessage=function(e){console.log(e.data),t.send("pong "+e.data.substring(5))}}:(console.log("gggg"),this.time_start=null,this.dc=this.pc.createDataChannel("chat",{ordered:!0}),this.dc.onclose=function(){clearInterval(this.dcInterval),console.log("- close")},this.dc.onopen=function(){console.log("- open"),this.dcInterval=setInterval((function(){var t="ping "+e.current_stamp();console.log("> "+t),e.rttpp+="> "+t+"\n",e.dc.send(t)}),1e3)},this.dc.onmessage=function(t){if(console.log("< "+t.data),e.rttpp+="< "+t.data+"\n","pong"===t.data.substring(0,4)){var n=e.current_stamp()-parseInt(t.data.substring(5),10);console.log(" RTT "+n+" ms"),e.rttpp+=" RTT "+n+" ms\n",e.rowque+=t.data.substring(5)+","+n+";",e.csvfcount++,e.csvfcount>10&&(e.csvf=!e.csvf,e.csvfcount=0)}}),this.reciever)console.log(this.fetchData),"{token:'terminate'}"==this.fetchData["Message"]?console.log("terminate2"):(this.recievedMsg=this.fetchData["Message"],this.toUserId=this.fetchData["FromUserId"],this.sender,console.log(this.recievedMsg),console.log(JSON.parse(this.recievedMsg)),this.pc.setRemoteDescription(JSON.parse(this.recievedMsg))),console.log("answer"),this.pc.createAnswer().then((function(t){return console.log(t),e.pc.setLocalDescription(t)})).then((function(){var t=e.pc.localDescription;e.duct.controllers.resource.addDataForSpecificUser(e.toUserId,e.userId,JSON.stringify(t))}));else{if(!this.reciever){var n={sender:!0,reciever:!1};this.$emit("sr-change",n)}console.log(this.opponentId),this.pc.createOffer().then((function(t){return console.log("offer"),console.log(t),e.pc.setLocalDescription(t)})).then((function(){return new Promise((function(t){if("complete"===e.pc.iceGatheringState)t();else{function n(){"complete"===e.pc.iceGatheringState&&(e.pc.removeEventListener("icegatheringstatechange",n),t())}e.pc.addEventListener("icegatheringstatechange",n)}}))})).then((function(){var t=e.pc.localDescription;e.duct.controllers.resource.addDataForSpecificUser(e.opponentId,e.userId,JSON.stringify(t))}))}}},watch:{fetchData:function(){this.reciever||(console.log(this.fetchData),"{token:'terminate'}"==this.fetchData["Message"]?console.log("terminate2"):(this.recievedMsg=this.fetchData["Message"],this.toUserId=this.fetchData["FromUserId"],this.sender,console.log(this.recievedMsg),console.log(JSON.parse(this.recievedMsg)),this.pc.setRemoteDescription(JSON.parse(this.recievedMsg))))},csvf:function(){this.duct.controllers.resource.csvWriter([this.rowque]),this.rowque=""}}}),i=s,r=n("a6c2"),a=n("411c"),l=n.n(a),g=n("9c46d"),d=n("d58c"),u=n("e47e"),h=n("1fb1"),p=n("f56c"),v=n("c56b"),f=n("b503"),m=n("e614"),I=n("61ac"),w=n("fe39"),D=Object(r["a"])(i,o,c,!1,null,null,null);t["default"]=D.exports;l()(D,{VBtn:g["a"],VCard:d["a"],VCardActions:u["a"],VCardText:u["c"],VCardTitle:u["d"],VCol:h["a"],VContainer:p["a"],VDialog:v["a"],VIcon:f["a"],VRow:m["a"],VSpacer:I["a"],VTextarea:w["a"]})}}]);
//# sourceMappingURL=chunk-2d0d0455.9a7d6069.js.map